<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <h1 style="margin: 20px 100px 20px 400px;font-size: 50px;">Pong Game</h1>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
        aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto" id="loaded-header">
            <!-- header.html will be included here -->
            {% include 'pong/header.html' %}
        </ul>
    </div>
</nav>
<div class="container">
    <canvas id="canvas" width="550" height="400"></canvas>
</div>
{% load static %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="{%static 'pong/style.css'%}" />
<script src="{% static 'pong/main.js' %}"></script>
<script type="module">
    import {PongGame} from "{% static 'pongGame-es.js' %}";

    async function gameover(opponent, score_user, score_opponent, result) {
        const url = window.location.origin + "/pong/gameover/";
        const csrftoken = getCookie('csrftoken');
        const formData = new FormData();
        formData.append("opponent", opponent);
        formData.append("score_user", score_user);
        formData.append("score_opponent", score_opponent);
        formData.append("result", result);
        await fetch(url, {
            method: "POST",
            headers: {
                "X-CSRFToken": csrftoken,
            },
            body: formData
        })
            .then((promise) => promise.text())
            .then((text) => {
                // document.body.innerHTML = text;
                // setLoginEventHandler();
                // setSignupEventHandler();
                // setMypageEventHandler();
                // setLogoutEventHandler();
            })
            .catch((err) => console.log(err));
    }

    const pongGame = new PongGame(document.getElementById("canvas"), {
        helvetica: "{% static 'pong/font/helvetiker_regular.typeface.json' %}",
        pong: "{% static 'pong/font/Pong_Score_Regular.json' %}"
    })

    pongGame.onScoreChange((l, r) => {
        if (l >= 3) {
            gameover("peer", l, r, 1);
            pongGame.leftWin()
        }
        if (r >= 3) {
            gameover("computer", l, r, 0);
            pongGame.rightWin()
        }
    })
</script>
